# Story 2.1: Migrate Lead Management Features

## Status
Draft

## Story

**As a** developer,
**I want** to migrate all lead management functionality from micro-apps to the monolithic structure,
**so that** users can manage leads in the unified application.

## Acceptance Criteria

1. Migrate lead list and detail views to the new structure
2. Migrate lead creation and editing forms
3. Migrate lead import/export functionality
4. Migrate lead scoring and prioritization features
5. Migrate lead communication tracking
6. Ensure all lead management features work seamlessly in the new structure

## Tasks / Subtasks

- [ ] Task 1: Migrate lead list and detail views (AC: 1)
  - [ ] Migrate LeadList component from micro-apps
  - [ ] Migrate LeadCard component with all functionality
  - [ ] Migrate LeadDetail component with full feature set
  - [ ] Update routing to use new monolithic structure
  - [ ] Ensure all lead data displays correctly
  - [ ] Test lead list performance with large datasets

- [ ] Task 2: Migrate lead creation and editing forms (AC: 2)
  - [ ] Migrate LeadForm component with validation
  - [ ] Migrate lead editing functionality
  - [ ] Integrate with shared form components from Story 1.2
  - [ ] Ensure form validation works correctly
  - [ ] Test form submission and error handling
  - [ ] Verify lead data persistence

- [ ] Task 3: Migrate lead import/export functionality (AC: 3)
  - [ ] Migrate CSV import functionality
  - [ ] Migrate CSV export functionality
  - [ ] Migrate lead data validation and mapping
  - [ ] Integrate with shared utility functions
  - [ ] Test import/export with various file formats
  - [ ] Verify data integrity during import/export

- [ ] Task 4: Migrate lead scoring and prioritization (AC: 4)
  - [ ] Migrate AI-powered lead scoring functionality
  - [ ] Migrate lead prioritization algorithms
  - [ ] Migrate scoring display and management
  - [ ] Integrate with shared hooks for API calls
  - [ ] Test scoring accuracy and performance
  - [ ] Verify scoring updates in real-time

- [ ] Task 5: Migrate lead communication tracking (AC: 5)
  - [ ] Migrate communication history display
  - [ ] Migrate communication logging functionality
  - [ ] Migrate SMS and email integration
  - [ ] Integrate with Twilio and email services
  - [ ] Test communication tracking accuracy
  - [ ] Verify communication data persistence

- [ ] Task 6: Integration and testing (AC: 6)
  - [ ] Integrate all lead management features
  - [ ] Test feature interactions and dependencies
  - [ ] Verify performance and responsiveness
  - [ ] Test error handling and edge cases
  - [ ] Validate user experience and workflows
  - [ ] Ensure backward compatibility

## Dev Notes

### Previous Story Insights
This story depends on Epic 1 being completed, specifically:
- Story 1.1: Monolithic application structure
- Story 1.2: Shared component library and utilities
- Story 1.3: Build and deployment pipeline

The foundation should include:
- Unified Next.js application structure
- Shared UI components and hooks
- API service integration patterns
- Testing framework and utilities

### Data Models
Based on the existing lead management implementation, the following data models are used:

**Lead Model:**
```typescript
interface Lead {
  id: string;
  leadId: string;
  firstName: string;
  lastName: string;
  email: string;
  phone: string;
  company: string;
  status: string;
  priority: string;
  value: number;
  stageId: string;
  assignedTo?: string;
  createdAt: Date;
  updatedAt: Date;
  lastContactedAt?: Date;
  notes?: string;
  tags?: string[];
  source: string;
  score?: number;
}
```

**Communication Log Model:**
```typescript
interface CommunicationLog {
  id: string;
  leadId: string;
  type: 'email' | 'sms' | 'call' | 'note';
  content: string;
  timestamp: Date;
  userId: string;
  status: 'sent' | 'delivered' | 'failed';
}
```

### API Specifications
The lead management features integrate with the following API endpoints:

**Lead Management APIs:**
- GET /api/leads - Get all leads with filtering and pagination
- POST /api/leads - Create new lead
- PUT /api/leads/:id - Update lead
- DELETE /api/leads/:id - Delete lead
- GET /api/leads/:id - Get lead details
- POST /api/leads/import - Import leads from CSV
- GET /api/leads/export - Export leads to CSV

**Lead Scoring APIs:**
- POST /api/leads/:id/score - Score lead using AI
- GET /api/leads/scoring/history - Get scoring history
- PUT /api/leads/:id/priority - Update lead priority

**Communication APIs:**
- GET /api/leads/:id/communications - Get communication history
- POST /api/leads/:id/communications - Log new communication
- POST /api/leads/:id/send-sms - Send SMS to lead
- POST /api/leads/:id/send-email - Send email to lead

### Component Specifications
Based on the existing micro-apps implementation, the following components should be migrated:

**LeadList Component:**
```typescript
interface LeadListProps {
  leads: Lead[];
  onLeadSelect: (lead: Lead) => void;
  onLeadEdit: (lead: Lead) => void;
  onLeadDelete: (leadId: string) => void;
  filters: LeadFilters;
  onFiltersChange: (filters: LeadFilters) => void;
  pagination: PaginationState;
  onPaginationChange: (pagination: PaginationState) => void;
}
```

**LeadForm Component:**
```typescript
interface LeadFormProps {
  lead?: Lead;
  onSubmit: (leadData: Partial<Lead>) => void;
  onCancel: () => void;
  isLoading?: boolean;
}
```

**LeadDetail Component:**
```typescript
interface LeadDetailProps {
  lead: Lead;
  communications: CommunicationLog[];
  onLeadUpdate: (leadData: Partial<Lead>) => void;
  onCommunicationAdd: (communication: Partial<CommunicationLog>) => void;
}
```

### File Locations
Based on the monolithic structure from Story 1.1, the following structure should be created:

```
src/frontend/
├── features/
│   └── leads/
│       ├── components/
│       │   ├── LeadList/
│       │   │   ├── LeadList.tsx
│       │   │   ├── LeadList.test.tsx
│       │   │   └── index.ts
│       │   ├── LeadCard/
│       │   │   ├── LeadCard.tsx
│       │   │   ├── LeadCard.test.tsx
│       │   │   └── index.ts
│       │   ├── LeadDetail/
│       │   │   ├── LeadDetail.tsx
│       │   │   ├── LeadDetail.test.tsx
│       │   │   └── index.ts
│       │   ├── LeadForm/
│       │   │   ├── LeadForm.tsx
│       │   │   ├── LeadForm.test.tsx
│       │   │   └── index.ts
│       │   ├── LeadImportExport/
│       │   │   ├── LeadImportExport.tsx
│       │   │   ├── LeadImportExport.test.tsx
│       │   │   └── index.ts
│       │   ├── LeadScoring/
│       │   │   ├── LeadScoring.tsx
│       │   │   ├── LeadScoring.test.tsx
│       │   │   └── index.ts
│       │   └── CommunicationHistory/
│       │       ├── CommunicationHistory.tsx
│       │       ├── CommunicationHistory.test.tsx
│       │       └── index.ts
│       ├── hooks/
│       │   ├── useLeads.ts
│       │   ├── useLeadScoring.ts
│       │   └── useLeadCommunications.ts
│       ├── services/
│       │   ├── leadService.ts
│       │   ├── leadScoringService.ts
│       │   └── communicationService.ts
│       ├── types/
│       │   └── lead.types.ts
│       └── index.ts
└── pages/
    └── leads/
        ├── index.tsx
        ├── [id].tsx
        ├── new.tsx
        └── import-export.tsx
```

### Testing Requirements
- All migrated components should have comprehensive unit tests
- Integration tests should verify API interactions
- End-to-end tests should validate user workflows
- Performance tests should ensure acceptable load times
- Accessibility tests should verify WCAG compliance

### Technical Constraints
- Must maintain all existing functionality from micro-apps
- Must integrate with shared components from Story 1.2
- Must use shared hooks and utilities
- Must follow established TypeScript patterns
- Must maintain performance standards

### Testing
**Testing Standards:**
- Unit tests for all migrated components
- Integration tests for API interactions
- End-to-end tests for user workflows
- Performance testing for large datasets
- Accessibility testing for WCAG compliance

**Testing Frameworks:**
- Jest and React Testing Library for unit tests
- Cypress or Playwright for end-to-end tests
- Performance testing with Lighthouse
- Accessibility testing with axe-core

**Specific Testing Requirements:**
- Test lead CRUD operations
- Test import/export functionality
- Test lead scoring accuracy
- Test communication tracking
- Test form validation and error handling
- Test responsive design and mobile compatibility

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-05 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record

### Agent Model Used
*To be populated by development agent*

### Debug Log References
*To be populated by development agent*

### Completion Notes List
*To be populated by development agent*

### File List
*To be populated by development agent*

## QA Results
*To be populated by QA agent* 