# Story 3.2: Migrate Analytics Pages and Dashboards

## Story Information
- **Story ID**: 3.2
- **Title**: Migrate Analytics Pages and Dashboards
- **Epic**: Analytics Feature Migration
- **Sprint**: Sprint 4
- **Priority**: Medium
- **Story Points**: 5
- **Status**: Draft

## Description
Migrate analytics pages and dashboard layouts to the monolithic structure, preserving existing dashboard configurations, widget functionality, and ensuring responsive design works across all devices.

## Acceptance Criteria
- [ ] **AC 1**: Migrate all analytics pages and dashboard layouts
- [ ] **AC 2**: Preserve existing dashboard configurations and layouts
- [ ] **AC 3**: Maintain dashboard customization and widget functionality
- [ ] **AC 4**: Set up Next.js routing for all analytics routes
- [ ] **AC 5**: Ensure responsive design works for all analytics views
- [ ] **AC 6**: Preserve dashboard sharing and export functionality

## Tasks

### Task 1: Migrate analytics pages and layouts (AC: 1)
- [ ] Migrate main analytics dashboard page
- [ ] Migrate detailed analytics pages (reports, insights, etc.)
- [ ] Migrate analytics navigation and breadcrumbs
- [ ] Update page layouts to use shared components
- [ ] Ensure proper page structure and metadata
- [ ] Implement analytics-specific layouts and containers

### Task 2: Preserve dashboard configurations (AC: 2)
- [ ] Migrate dashboard layout configurations
- [ ] Preserve widget positioning and sizing
- [ ] Maintain dashboard theme and styling preferences
- [ ] Preserve user-specific dashboard customizations
- [ ] Migrate dashboard state management
- [ ] Ensure dashboard persistence across sessions

### Task 3: Maintain widget functionality (AC: 3)
- [ ] Migrate all analytics widgets (charts, tables, metrics)
- [ ] Preserve widget interaction and drill-down capabilities
- [ ] Maintain widget data refresh and real-time updates
- [ ] Preserve widget customization options
- [ ] Implement widget drag-and-drop functionality
- [ ] Ensure widget performance and responsiveness

### Task 4: Set up Next.js routing (AC: 4)
- [ ] Create analytics route structure in Next.js
- [ ] Implement dynamic routing for analytics pages
- [ ] Set up route guards for analytics access
- [ ] Implement analytics page navigation
- [ ] Add analytics breadcrumb navigation
- [ ] Ensure proper route handling and fallbacks

### Task 5: Implement responsive design (AC: 5)
- [ ] Ensure analytics pages work on mobile devices
- [ ] Implement responsive dashboard layouts
- [ ] Optimize widget layouts for different screen sizes
- [ ] Ensure touch interactions work properly
- [ ] Test analytics pages on various devices
- [ ] Implement responsive navigation for analytics

### Task 6: Preserve sharing and export features (AC: 6)
- [ ] Migrate dashboard sharing functionality
- [ ] Preserve export capabilities (PDF, CSV, etc.)
- [ ] Maintain dashboard collaboration features
- [ ] Implement dashboard access controls
- [ ] Preserve dashboard embedding functionality
- [ ] Ensure export formats and options work correctly

## Dev Notes

### Previous Story Insights
This story depends on Stories 1.1, 1.2, and 3.1 being completed. The foundation includes:
- Monolithic Next.js application structure with TypeScript
- Shared component library with UI components, layout components, and form components
- Analytics components and visualizations already migrated (Story 3.1)
- Shared hooks and utilities for data handling
- Design system with Chakra UI theme
- Chart components and data visualization tools

### Data Models
Based on the architecture and previous stories:
- **Analytics Data Models**: Chart data structures and metrics [Source: Architecture_Overview_Wholesaling_CRM.md#Data Models]
- **Dashboard Configuration**: User dashboard layouts and preferences
- **Widget Models**: Individual widget configurations and states
- **Export Models**: Data export formats and configurations

### API Specifications
The analytics pages will integrate with:
- **Analytics API**: `/api/analytics` for dashboard data [Source: Architecture_Overview_Wholesaling_CRM.md#Backend Structure]
- **Metrics API**: `/api/metrics` for performance metrics
- **Reports API**: `/api/reports` for detailed analytics reports
- **Export API**: `/api/export` for data export functionality
- **Sharing API**: `/api/sharing` for dashboard sharing features

### Component Specifications
The analytics pages will use existing components from Story 1.2:
- **Layout Components**: Sidebar, Header, Navigation for analytics layout
- **UI Components**: Card, Table, Chart for data display
- **Form Components**: For analytics filters and controls
- **Loading Components**: For data loading states
- **Error Components**: For error handling and display

### File Locations
Based on the current project structure from Story 1.2:

```
src/frontend/
├── pages/
│   ├── analytics/
│   │   ├── index.tsx                 # Main analytics dashboard
│   │   ├── reports/
│   │   │   ├── index.tsx             # Reports overview
│   │   │   └── [id].tsx              # Individual report
│   │   ├── insights/
│   │   │   └── index.tsx             # Insights page
│   │   └── export/
│   │       └── index.tsx             # Export functionality
│   └── dashboard.tsx                 # Main dashboard (update)
├── components/
│   ├── analytics/
│   │   ├── AnalyticsDashboard.tsx    # Main dashboard component
│   │   ├── AnalyticsWidget.tsx       # Widget wrapper component
│   │   ├── AnalyticsFilters.tsx      # Analytics filters
│   │   └── AnalyticsExport.tsx       # Export functionality
│   └── layout/
│       ├── Sidebar.tsx               # Analytics navigation (update)
│       └── Header.tsx                # Analytics header (update)
├── hooks/
│   ├── useAnalytics.ts               # Analytics data hook
│   ├── useDashboard.ts               # Dashboard state hook
│   └── useExport.ts                  # Export functionality hook
└── utils/
    ├── analytics.ts                  # Analytics utilities
    └── export.ts                     # Export utilities
```

### Testing Requirements
Based on the architecture and previous story context:
- **Unit Tests**: Test all analytics page components
- **Integration Tests**: Test dashboard data loading and interactions
- **E2E Tests**: Test complete analytics workflows
- **Responsive Tests**: Test analytics pages on different devices
- **Performance Tests**: Test dashboard loading and widget performance

### Technical Constraints
From the architecture documentation:
- **Data Visualization**: Recharts for charts and graphs [Source: Architecture_Overview_Wholesaling_CRM.md#Stack Overview]
- **Responsive Design**: Mobile-first approach with Chakra UI [Source: Architecture_Overview_Wholesaling_CRM.md#Stack Overview]
- **Real-time Updates**: WebSocket integration for live data [Source: Architecture_Overview_Wholesaling_CRM.md#Stack Overview]
- **Performance**: Optimized data loading and caching
- **Accessibility**: WCAG compliance for analytics interfaces

### Integration Points
The analytics pages must integrate with:
- **Backend Analytics API**: NestJS analytics endpoints [Source: Architecture_Overview_Wholesaling_CRM.md#Backend Structure]
- **Real-time Data**: WebSocket connections for live updates
- **Export Services**: PDF/CSV generation services
- **Sharing Services**: Dashboard sharing and collaboration
- **Authentication**: Role-based access to analytics features

### Performance Considerations
From the architecture scalability considerations:
- **Data Caching**: Implement caching for analytics data
- **Lazy Loading**: Load analytics widgets on demand
- **Code Splitting**: Split analytics code into chunks
- **Image Optimization**: Optimize chart images and exports
- **Bundle Optimization**: Minimize analytics bundle size

### Security Considerations
From the architecture security section:
- **Data Access**: Role-based access to analytics data
- **Export Security**: Secure export functionality
- **Sharing Controls**: Proper dashboard sharing permissions
- **Data Privacy**: Ensure sensitive data is protected
- **Audit Logging**: Log analytics access and exports

### Project Structure Notes
The current project structure from Story 1.2 includes:
- `src/frontend/components/ui/` - 7 core UI components including Chart component
- `src/frontend/components/layout/` - 4 layout components
- `src/frontend/hooks/` - 8 custom hooks including analytics hooks
- `src/frontend/utils/` - 5 utility modules
- `src/frontend/pages/` - Feature pages including analytics pages

The analytics pages must preserve this structure while providing comprehensive analytics functionality with proper responsive design and user experience.

## Integration Verification
- **IV1**: Verify all analytics pages load correctly with proper data
- **IV2**: Confirm dashboard layouts and widgets work as expected
- **IV3**: Ensure responsive design works on all devices and screen sizes

## Next Steps
After completion of this story, the analytics pages and dashboards will be fully migrated to the monolithic structure. The next story (Story 3.3: Integrate Analytics with Shared Services) can proceed with integrating analytics features with shared services and utilities. 