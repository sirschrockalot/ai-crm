# Story 4.1: Migrate Automation Components

## Story Information
- **Story ID**: 4.1
- **Title**: Migrate Automation Components
- **Epic**: Automation Feature Migration
- **Sprint**: Sprint 5
- **Priority**: Medium
- **Story Points**: 6
- **Status**: Draft

## Description
Migrate all automation components to the monolithic structure, preserving workflow creation and management functionality while integrating with the shared component library and design system.

## Acceptance Criteria
- [ ] **AC 1**: Migrate all automation components (workflow builder, trigger configurator, etc.)
- [ ] **AC 2**: Preserve all workflow creation and management functionality
- [ ] **AC 3**: Update components to use shared design system
- [ ] **AC 4**: Maintain automation trigger and action configurations
- [ ] **AC 5**: Ensure all automation interactions work correctly
- [ ] **AC 6**: Update styling to use Chakra UI design system

## Tasks

### Task 1: Migrate workflow builder components (AC: 1)
- [ ] Migrate workflow builder interface component
- [ ] Migrate workflow canvas and drag-and-drop functionality
- [ ] Migrate workflow node components (triggers, actions, conditions)
- [ ] Migrate workflow connection and routing components
- [ ] Migrate workflow validation and error display components
- [ ] Ensure all workflow builder interactions work correctly

### Task 2: Migrate trigger configurator components (AC: 1, 4)
- [ ] Migrate trigger selection and configuration components
- [ ] Migrate trigger condition builder components
- [ ] Migrate trigger testing and validation components
- [ ] Preserve all trigger configuration functionality
- [ ] Maintain trigger data mapping and transformation
- [ ] Ensure trigger configurations are properly saved and loaded

### Task 3: Migrate action configurator components (AC: 1, 4)
- [ ] Migrate action selection and configuration components
- [ ] Migrate action parameter builder components
- [ ] Migrate action testing and validation components
- [ ] Preserve all action configuration functionality
- [ ] Maintain action data mapping and transformation
- [ ] Ensure action configurations are properly saved and loaded

### Task 4: Preserve workflow management functionality (AC: 2)
- [ ] Migrate workflow list and management components
- [ ] Preserve workflow status and monitoring components
- [ ] Migrate workflow execution history components
- [ ] Maintain workflow versioning and rollback functionality
- [ ] Preserve workflow sharing and collaboration features
- [ ] Ensure workflow templates and presets work correctly

### Task 5: Update components to use shared design system (AC: 3, 6)
- [ ] Replace custom styling with Chakra UI components
- [ ] Use shared Button, Modal, Card components
- [ ] Implement consistent form components and validation
- [ ] Use shared loading and error states
- [ ] Apply consistent color scheme and typography
- [ ] Ensure responsive design works across all components

### Task 6: Verify automation interactions (AC: 5)
- [ ] Test workflow creation and editing interactions
- [ ] Verify trigger configuration and testing
- [ ] Test action configuration and validation
- [ ] Validate workflow execution and monitoring
- [ ] Test workflow import/export functionality
- [ ] Ensure all automation features work seamlessly

## Dev Notes

### Previous Story Insights
This story depends on Stories 1.1, 1.2, and all previous epics being completed. The foundation includes:
- Monolithic Next.js application structure with TypeScript
- Shared component library with UI components, layout components, and form components
- Shared hooks and utilities for data handling and state management
- Design system with Chakra UI theme
- Lead management and analytics features already migrated

### Data Models
Based on the architecture and previous stories:
- **Workflow Model**: Workflow schema with triggers, actions, and conditions [Source: Architecture_Overview_Wholesaling_CRM.md#Data Models]
- **Trigger Models**: Trigger configuration and condition structures
- **Action Models**: Action configuration and parameter structures
- **Execution Models**: Workflow execution history and status tracking

### API Specifications
The automation components will integrate with:
- **Automation API**: `/api/automation` for workflow management [Source: Architecture_Overview_Wholesaling_CRM.md#Backend Structure]
- **Workflow API**: `/api/workflows` for workflow CRUD operations
- **Execution API**: `/api/executions` for workflow execution tracking
- **Trigger API**: `/api/triggers` for trigger configuration and testing
- **Action API**: `/api/actions` for action configuration and testing

### Component Specifications
The automation components will use existing components from Story 1.2:
- **UI Components**: Button, Modal, Card, Table for automation interfaces
- **Form Components**: LeadForm, BuyerForm patterns for configuration forms
- **Layout Components**: Sidebar, Header, Navigation for automation layout
- **Loading Components**: Loading component for automation operations
- **Error Components**: Error boundary and error display patterns

### File Locations
Based on the current project structure from Story 1.2:

```
src/frontend/
├── components/
│   ├── automation/
│   │   ├── WorkflowBuilder.tsx       # Main workflow builder
│   │   ├── WorkflowCanvas.tsx        # Workflow canvas component
│   │   ├── WorkflowNode.tsx          # Individual workflow node
│   │   ├── WorkflowConnection.tsx    # Connection between nodes
│   │   ├── TriggerConfigurator.tsx   # Trigger configuration
│   │   ├── ActionConfigurator.tsx    # Action configuration
│   │   ├── WorkflowList.tsx          # Workflow management list
│   │   ├── WorkflowMonitor.tsx       # Workflow execution monitoring
│   │   └── WorkflowHistory.tsx       # Execution history
│   ├── ui/
│   │   ├── Button.tsx                # Shared button component (already exists)
│   │   ├── Modal.tsx                 # Shared modal component (already exists)
│   │   ├── Card.tsx                  # Shared card component (already exists)
│   │   └── Table.tsx                 # Shared table component (already exists)
│   └── forms/
│       ├── WorkflowForm.tsx          # Workflow configuration form (already exists)
│       └── TriggerForm.tsx           # Trigger configuration form (create)
├── hooks/
│   ├── useAutomation.ts              # Automation data hook (create)
│   ├── useWorkflow.ts                # Workflow management hook (create)
│   └── useExecution.ts               # Execution tracking hook (create)
├── pages/
│   └── automation/
│       ├── index.tsx                 # Automation dashboard page (create)
│       ├── workflows/
│       │   ├── index.tsx             # Workflow list page (create)
│       │   ├── [id].tsx              # Workflow detail page (create)
│       │   └── new.tsx               # New workflow page (create)
│       └── executions/
│           └── index.tsx             # Execution history page (create)
└── utils/
    ├── workflow.ts                   # Workflow utilities (create)
    └── automation.ts                 # Automation utilities (create)
```

### Testing Requirements
Based on the architecture and previous story context:
- **Unit Tests**: Test all automation components and interactions
- **Integration Tests**: Test workflow creation and management flows
- **E2E Tests**: Test complete automation workflows
- **Performance Tests**: Test workflow builder performance
- **Accessibility Tests**: Test automation interfaces for accessibility

### Technical Constraints
From the architecture documentation:
- **Workflow Engine**: Backend workflow execution engine [Source: Architecture_Overview_Wholesaling_CRM.md#Backend Structure]
- **Real-time Updates**: WebSocket integration for workflow status [Source: Architecture_Overview_Wholesaling_CRM.md#Stack Overview]
- **State Management**: React hooks with proper TypeScript types
- **Form Validation**: React Hook Form with Zod validation [Source: Architecture_Overview_Wholesaling_CRM.md#Stack Overview]
- **UI Framework**: Chakra UI for consistent design [Source: Architecture_Overview_Wholesaling_CRM.md#Stack Overview]

### Integration Points
The automation components must integrate with:
- **Backend Automation API**: NestJS automation endpoints [Source: Architecture_Overview_Wholesaling_CRM.md#Backend Structure]
- **Workflow Engine**: Backend workflow execution service
- **Real-time Updates**: WebSocket connections for workflow status
- **Lead Management**: Integration with lead triggers and actions
- **Communication Services**: Integration with communication triggers and actions

### Performance Considerations
From the architecture scalability considerations:
- **Workflow Builder**: Optimized drag-and-drop performance
- **Real-time Updates**: Efficient WebSocket data handling
- **State Management**: Optimized workflow state updates
- **Validation**: Fast workflow validation and error checking
- **Rendering**: Efficient component rendering for complex workflows

### Security Considerations
From the architecture security section:
- **Workflow Access**: Role-based access to workflow creation and management
- **Trigger Security**: Secure trigger configuration and execution
- **Action Security**: Secure action configuration and execution
- **Data Validation**: Input validation for workflow configurations
- **Execution Logging**: Proper logging of workflow executions

### Project Structure Notes
The current project structure from Story 1.2 includes:
- `src/frontend/components/ui/` - 7 core UI components
- `src/frontend/components/forms/` - 3 form components including WorkflowForm
- `src/frontend/hooks/` - 8 custom hooks
- `src/frontend/utils/` - 5 utility modules
- `src/frontend/pages/` - Feature pages

The automation components must preserve this structure while providing comprehensive workflow creation and management functionality with proper integration to the shared component library.

## Integration Verification
- **IV1**: Verify all automation features function correctly with proper workflow creation
- **IV2**: Confirm workflow creation and management work as expected
- **IV3**: Ensure automation triggers and actions work properly with proper configuration

## Next Steps
After completion of this story, the automation components will be fully migrated to the monolithic structure. The next story (Story 4.2: Migrate Automation Pages and Workflows) can proceed with migrating automation pages and workflow management interfaces. 